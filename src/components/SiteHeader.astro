---
import { getLangFromUrl, langPrefix, switchLangPath, t } from "../i18n";
import type { Lang } from "../i18n";

const lang: Lang = getLangFromUrl(Astro.url);
const prefix = langPrefix(lang);
const siteTitle = "Lumen Arkhé";

const secciones = [
  { name: t("nav.ensayos", lang),  href: `${prefix}/articulos?sec=Ensayos` },
  { name: t("nav.resenas", lang),  href: `${prefix}/articulos?sec=Reseñas` },
  { name: t("nav.cronica", lang),  href: `${prefix}/articulos?sec=Crónica` },
  { name: t("nav.archivo", lang),  href: `${prefix}/pdf` },
];

const esPath = switchLangPath(Astro.url.pathname, "es");
const enPath = switchLangPath(Astro.url.pathname, "en");
---

<header class="a-head">
  <div class="a-head__top">
    <div class="a-lang">
      <a class={`a-lang__${lang === "es" ? "on" : "off"}`} href={esPath} aria-current={lang === "es" ? "true" : undefined}>ES</a>
      <span class="a-dot">•</span>
      <a class={`a-lang__${lang === "en" ? "on" : "off"}`} href={enPath} aria-current={lang === "en" ? "true" : undefined}>EN</a>
    </div>

    <div class="a-title">
      <a class="a-title__brand" href={`${prefix}/`}>{siteTitle.toUpperCase()}</a>
    </div>

    <div style="display:flex; align-items:center; gap:8px; justify-self:end;">
      <a class="a-ingresa" href="#">{t("nav.ingresa", lang).toUpperCase()}</a>
      <button class="a-burger" id="menuBurger" type="button" aria-label={t("nav.abrir_menu", lang)} aria-expanded="false">
        <span id="burgerIcon">☰</span>
      </button>
    </div>
  </div>

  <nav class="a-menu" id="mainMenu" aria-label={t("foot.secciones", lang)}>
    {secciones.map((s) => (
      <a class="a-menu__a" href={s.href}>{s.name.toUpperCase()}</a>
    ))}
    <span class="a-bar" aria-hidden="true">|</span>
    <a class="a-menu__a" href={`${prefix}/newsletter`}>{t("nav.newsletter", lang).toUpperCase()}</a>
    <a class="a-menu__a" href={`${prefix}/articulos`}>{t("nav.busqueda", lang).toUpperCase()}</a>
  </nav>

  <script is:inline>
    (() => {
      const btn = document.getElementById("menuBurger");
      const menu = document.getElementById("mainMenu");
      const icon = document.getElementById("burgerIcon");
      if (!btn || !menu) return;

      btn.addEventListener("click", () => {
        const open = menu.classList.toggle("is-open");
        btn.setAttribute("aria-expanded", String(open));
        icon.textContent = open ? "✕" : "☰";
      });
    })();
  </script>
</header>
